Baukis 改
===================
[![CircleCI Build Status](https://circleci.com/gh/circleci/circleci-docs.svg?style=shield)](https://circleci.com/gh/k2works/baukis-kai) [![Code Climate](https://codeclimate.com/github/k2works/baukis-kai/badges/gpa.svg)](https://codeclimate.com/github/k2works/baukis-kai) [![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://raw.githubusercontent.com/k2works/baukis-kai/master/MIT-LICENSE.txt)

# 目的 #
[実践Ruby on Rails 4 現場のプロから学ぶ本格Webプログラミング](https://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5Ruby-Rails-4-%E7%8F%BE%E5%A0%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E6%9C%AC%E6%A0%BCWeb%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E9%BB%92%E7%94%B0/dp/4844335928)をRails5での実装及びフロント部分にモダンCSS設計(BEM)を組み込む

# 前提 #
| ソフトウェア   | バージョン   | 備考        |
|:---------------|:-------------|:------------|
| ruby           |2.4.0    |             |
| rails          |5.0.1    |             |
| vagrant        |1.8.7    |             |
| docker         |1.12.5    |             |
| docker-compose |1.8.0    |             |

# 構成 #
1. [アプリケーション環境構築](#アプリケーション環境構築)
   1. [Vagarntのセットアップ](#Vagarntのセットアップ)
   1. [Dockerのセットアップ](#Dockerのセットアップ)
   1. [追加Gemセットアップ](#追加Gemセットアップ)
   1. [その他の準備作業](#その他の準備作業)
   1. [テスト環境のセットアップ](#テスト環境のセットアップ)
1. [アプリケーション配置](#アプリケーション配置)
   1. [Herokuセットアップ](#Herokuセットアップ)
   1. [CircleCIセットアップ](#CircleCIセットアップ)
1. [アプリケーション開発](#アプリケーション開発)
   1. [ビジュアルデザイン](#ビジュアルデザイン)
   1. [エラーページ](#エラーページ)
   1. [ユーザー認証(1)](#ユーザー認証(1))
   1. [ユーザー認証(2)](#ユーザー認証(2))
   1. [ルーティング](#ルーティング)
   1. [レコードの表示、新規作成、更新、削除](#レコードの表示、新規作成、更新、削除)
   1. [String Parameters](#String Parameters])
   1. [アクセス制御](#アクセス制御)
   1. [モデル間の関連付け](#モデル間の関連付け)
   1. [値の正規化とバリデーション](#値の正規化とバリデーション)
   1. [プレゼンター](#プレゼンター)
   1. [jQueryとCoffeeScript](#jQueryとCoffeeScript)
   1. [単一テーブ継承](#単一テーブ継承)
   1. [Capybra](#Capybara)
   1. [フォームオブジェクト](#フォームオブジェクト)
   1. [検索フォーム](#検索フォーム)

## アプリケーション環境構築
### Vagarntのセットアップ
```
vagrant up
vagrant ssh
```

### Dockerのセットアップ
```
cd /vagrant/
docker-compose build
```

### 追加Gemセットアップ

### その他の準備作業
+ ライセンス文書の作成
+ タイムゾーンとロケールの設定
+ ジェネレータの設定
+ アプリケーション実行URLの設定

### テスト環境のセットアップ
+ RSpecの初期設定
+ Factory Girlの初期設定

**[⬆ back to top](#構成)**

## アプリケーション配置

### Herokuセットアップ
```bash
heroku create baukis-kai
git push heroku master
```

### CircleCIセットアップ

**[⬆ back to top](#構成)**
## アプリケーション開発
### ビジュアルデザイン
#### 仮設トップページ
+ ルーティングの設定
+ コントローラとアクションの作成
+ ERBテンプレートの作成
+ レイアウト
+ 部分テンプレート
+ ヘルパーメソッドの定義

#### Sass/SCSS
+ アセットパイプライン
+ Sass/SCSSとは
+ スタイルシートの切り替え
+ ヘッダとフッタのスタイル
+ 見出し(h1要素)のスタイル
+ 色を変数で表現する
+ 寸法を変数で表現する
+ アセットのプリコンパイル

## よいCSSを書くためのHTMLマークアップ-CSS設計-
### デザインカンプを確認し、CSS設計を理解しよう
#### コンポーネント
+ ヘッダー
+ カルーセル
+ サムネイル画像付きコンテンツ
+ オーバーレイパネル
+ アイコン付きコンテンツ
+ ニュースリスト
+ フッター

#### CSS設計
+ BEM
+ [OOCSS](http://oocss.org/)
+ [MCSS](http://operatino.github.io/MCSS/ja/)
+ [SMACSS](https://smacss.com/)

#### BEM
 + [BEM](https://en.bem.info/)
 + [MindBEMding](http://csswizardry.com/2013/01/mindbemding-getting-your-head-round-bem-syntax/)
 
#### classの命名規則について
+ Blockの最初の文字は大文字で書くこと
+ Elementの最初の文字は小文字で書く
+ BlockとElementは「__」でつなぐ
+ Modifierをつける場合は「--」でつなぐ

#### まとめ
 1. 最初は「見た目」からコンポーネントを割り出す
 1. 大文字や小文字などをうまく使い分ける
 1. 長いclass名はエディタの保管機能を使えば怖くない

### サイト制作の下準備をしよう

#### indexページ作成

#### フォルダを整理する

#### 分割したファイルを読み込む「import機能」

#### リセットCSSを導入する

#### 背景色を設定する

#### まとめ
+ どんなサイトを作る場合でも、まずリセットCSSを導入する
+ コンポーネントごとにファイルを分けて、一覧できるようにする
+ 変数は、変数だけのファイルを作成すると管理が楽になって効率的

### Headerを作成しよう

#### コンポーネントを意識してマークアップしよう

#### HTMLをマークアップ

#### まとめ
+ コンポーネントを、まずはBlockとして作ってみる
+ 複雑なコンポーネントはBlockの中にBlockを作ってみる
+ Elementは汎用的な命名をなるべく使い、どこのBlockに属するのかをわかりやすくする

## Sassを使ったサイト制作 その１（ヘッダーなど）

### ヘッダーのスタイルを作成しよう

#### Flexを利用したヘッダーのCSS  

#### 「画像+記事」のコンポーネントを作る

#### ボタンを作成する

#### まとめ
+ レイアウトは極力Flexを使って書く
+ Flexのショートハンドの書き方に慣れる
+ それ以上細かくできないコンポーネントはpartsとして作る

### レイアウトを作成しよう  
  
#### レイアウトを整えるCSSを作る

#### 全体的な幅を決める
#### まとめ
+ レイアウトについてはCSSからわかるように「l-」を付ける
+ レイアウトはコンポーネントではないのでpartsフォルダに作成する
+ Sassの四則演算を上手に使ってレイアウトを整える

## Sassを使ったサイト制作 その２（メインコンテンツやフッターなど）

### メインイメージを作成しよう
#### カルーセルを組み込むには

#### インジケータの制作 

#### JavaScriptを有効化する

#### まとめ
+ JavaScriptを読み込む位置は、bodyタグの終了タグの位置
+ JavaScriptと連携しているところは「js-」という接頭語をつける
+ 状態についてのCSSは「isXXX」という命名規則を使う

### コンテンツ部分を作成しよう

#### コンテンツ部の作成をはじめる

#### タイトル部分を作成する

#### OverlayPanelを作成する

#### 背景画像を設定する

#### アイコン付きのコンテンツメニューを作成する

#### ニュースのコンポーネントを作成する

#### まとめ
+ 疑似要素を使って、かしこくclassの指定をする
+ ページ専用の要素はコンポーネントとは別管理にする
+ 変数をセレクタで使える「インターポレーション」

### フッターを作成しよう

#### フッター作成を始める

#### Menuを修正する

### フォルダを整理しよう

#### これまで作成したもののおさらい

+ baseフォルダ                            
+ componentsフォルダ
+ commonフォルダ
+ pageフォルダ

#### まとめ
+ ただ作るのではなく、どのフォルダに属するのかを意識しながら作る
+ main.cssにコメントを残し、どういうファイルがあるかがひと目でわかるようにする

## プロらしく「魅せる」テクニック-トップページの総仕上げ-

### アイコンフォントを活用しよう

#### アイコンフォントを使う

#### まとめ
+ アイコンフォントと画像の違いを理解する
+ アイコンフォントは解像度に左右されない
+ FontAwesomeは便利なので、使い方をマスターする

### WebFontを利用しよう

#### WebFontを使うための準備

#### WebFontを使ってみよう

#### まとめ
+ WebFontはフォントの表現幅が大幅に上がる
+ WebFontをmixinとしておくことで、使いやすなる
+ WebFontを使いすぎるとパフォーマンスが下がるので注意する

### 突発的な修正に上手に対応しよう

#### 突発的な修正に上手に対応するには？

#### ユーティリティclassを作成する

#### まとめ
+ 汎用的なclassとわかるように「u-」の接頭辞をつける
+ 汎用的なclassを使ってうまくレイアウトを整える
+ コンポーネントの修正以外の視点を持つ

### Webページをレスポンシブ化しよう

#### mixinを作成する

#### 各コンポーネントのスマートフォン対応

#### まとめ
+ Media Queriesはレスポンシブの基本なので必ず覚える
+ @contentをうまく利用して、効率よくレスポンシブサイトを作成する
+ レスポンシブについてのCSSはmixinにして再利用可能にする

## パーツの組み合わせによる「高速」Webページ制作

### キャンペーンページを作成しよう

#### キャンペーンページのHTMLを確認する

#### 3つのコンテンツが並んでいるコンポーネントの制作

#### 横幅いっぱいの画像のコンポーネントと「アイコン+テキストコンポーネント」

#### フォームを作成する

#### まとめ
+ 新たに作るのではなく、すでに似たものを作っていないかという視点を持つ
+ 既存のコンポーネントを組み合わせて新たなページを作成する
+ Modifierを使ってデザインを調整する

### サイドバーのある画面を作ろう

#### Articleページを作成する

#### Flexを活用してサイドバーのあるレイアウトを作る

#### まとめ
+ Flexを使えば、面倒なサイドバーのレイアウトも簡単に
+ コンポーネントベースで作ると、ページ固有のCSSを少し追加するだけでほぼ１ページ作れる

### エラーページ
#### 例外処理の基礎知識
+ 例外とは
+ raiseメソッドと例外機構文
+ クラスメソッドrescue_from

#### 500 Internal Server Error
+ 準備作業
+ 例外の捕捉
+ ビジュアルデザイン

#### 403 Forbidden
+ 例外の捕捉
+ ERBテンプレートの作成
+ 動作の確認

#### 404 Not Found
+ 例外ActionController::RoutingErrorの処理
+ 例外ActiveRecord::RecordNotFoundの処理

#### ActiveSupport::Concern

### ユーザー認証(1)
#### マイグレーション
+ 各種スケルトンの作成
+ マイグレーションスクリプト
+ マイグレーションの実行
+ 主キー

#### モデル
+ モデルの基礎知識
+ 索引用メールアドレス
+ ハッシュ関数
+ シードデータ投入

#### セッション
+ セッションとは
+ current_staff_memberメソッドの定義
+ ルーティングの決定
+ リンクの設置

#### 演習問題
+ 管理者モデル作成
+ マイグレーション
+ コールバック追加
+ パスワードメソッドテスト作成
+ パスワードメソッド作成
+ シードデータ作成
+ コントローラベースクラス作成
+ ルーティング追加
+ リンクの追加

### ユーザー認証(2)
#### フォームオブジェクト
+ フォームの基礎知識
+ フォームオブジェクト
+ フォームオブジェクトとは
+ ログインフォームの作成
+ paramsオブジェクト
+ ログアウト機能の実装
+ スタイルシートの作成

#### サービスオブジェクト
+ Staff::Authenticatorクラス
+ サービスオブジェクトのspecファイル

#### ログイン・ログアウト後のメッセージ表示
+ フラッシュへの書き込み
+ メッセージの表示

#### 演習問題
+ 管理者用ログインフォーム作成
+ 管理者ログイン機能追加
+ 管理者ログアウト機能追加
+ 管理者認証サービステスト追加
+ 管理者認証サービス追加
+ メッセージの表示

#### 改
+ i18nの設定と適用

### ルーティング
#### ルーティングの基礎知識
+ アクション単位のルーティング
+ 名前空間

#### リソースベースのルーティング
+ ７つの基本アクション
+ ルーティングの分類
+ resourcesメソッド
+ リンクの設置
+ resourcesメソッドのオプション

#### 単数リソース
+ 単数リソースの６つの基本アクション
+ resourceメソッド
+ resourceメソッドのオプション

#### 制約
+ Rails.application.config
+ ホスト名による制約
+ ルーティングのテスト

#### 演習問題
+ ルーティングテスト追加
+ 顧客ルーティング追加

### レコードの表示、新規作成、更新、削除
#### 管理者による職員アカウント管理機能（前編）
+ 準備作業
+ indexアクション
+ showアクション
+ newアクション
+ editアクション

#### 管理者による職員アカウント管理機能（後編）
+ createアクション
+ updateアクション
+ destroyアクション

### String Parameters
#### String Parameters
+ マスアサインメント脆弱性
+ コントローラのテスト
+ 400 Bad Request

#### 職員自身によるアカウント管理機能
+ showアクション
+ editアクション
+ updateアクション
+ updateアクションのテスト

### アクセス制御
#### before_action
+ 管理者ページのアクセス制御
+ before_actionの継承
+ 職員ページのアクセス制御

#### アクセス制御の強化
+ 強制的ログアウト
+ セッションタイムアウト

#### アクセス制御のテスト
+ 失敗するエグザンプルの修正
+ 共有エグザンプル
+ 強制ログアウトのテスト
+ セッションタイムアウトのテスト

#### 演習問題
+ テスト作成
+ 機能追加

### モデル間の関連付け
#### モデル間の関連付け
+ 一対他の関連付け
+ 外部キー制約
+ StaffEventモデルの追加
+ イベントの記録

#### ネストされたリソース
+ ネストされたリソースとは
+ admin/staff_eventsコントローラ

#### ページネーション
+ シードデータの投入
+ Gemパッケージkaminari
+ indexアクションの修正
+ ERBテンプレートの修正
+ ページネーションのカスタマイズ

#### N + 1問題
+ Gemパッケージquiet_assets
+ N+1問題とは
+ includeメソッド
+ リファクタリング

#### 演習問題

### 値の正規化とバリデーション
#### モデルオブジェクトの正規化とバリデーション
+ 値の正規化とバリデーション
+ 準備作業 
+ 氏名とフリガナの正規化とバリデーション
+ 開始日と終了日のバリデーション
+ メールアドレスの正規化とバリデーション
+ 正規化とバリデーションのテスト

#### 職員が自分のパスワードを変更する機能
+ ルーティングの設定
+ リンクの設置
+ showアクション
+ editアクション
+ updateアクション
+ バリデーション

#### 演習問題
+ テスト追加
+ バリデーション追加

### プレゼンター
#### モデルプレゼンター
+ 問題の所在
+ プレゼンターとは
+ 委譲

#### HtmlBuilder
+ 問題の所在
+ HtmlBuilderモジュールの作成
+ markupメソッドの使用法
+ StaffEventPresenter

#### フォームプレゼンター
+ 問題の所在
+ FormPresenterクラスの定義
+ フォームプレゼンターの利用
+ さらなる改善

#### 入力エラーメッセージの生成
+ Errorsオブジェクト
+ エラーメッセージの設定
+ エラーメッセージの生成
+ パスワード変更フォームの改良

#### 演習問題

### jQueryとCoffeeScript
#### jQueryとCoffeeScript
+ 準備作業
+ 入力フォームの有効・無効を切り替える

#### Datapicker
+ 準備作業
+ Datepickerの利用

### 単一テーブ継承
#### 単一テーブル継承
+ 顧客管理のためのデータベース設計
+ 単一テーブル継承とは
+ 顧客関連テーブル群の作成
+ 顧客関連モデル群の初期実装

#### 顧客アカウントの一覧表示・詳細表示
+ シードデータの投入
+ 顧客アカウントの一覧表示
+ 顧客アカウントの詳細表示

#### 顧客アカウントの新規登録・編集フォーム
+ フォームオブジェクトの作成
+ new/editアクションの実装
+ フォームプレゼンターの作成
+ ERBテンプレート本体の作成
+ 部分テンプレート郡の作成

#### 顧客アカウントの新規登録・更新・削除
+ フォームオブジェクトの拡張
+ create/updateアクションの実装
+ destroyアクションの実装

### Capybara
#### Capybara
+ Capybaraとは
+ 準備作業
+ 顧客アカウント更新機能のテスト
+ 顧客アカウント新規登録機能のテスト

#### 顧客アカウント新規登録・更新機能の改良
+ モデルオブジェクトにおける値の正規化とバリデーション
+ フォームオブジェクトにおけるバリエーションの実施
+ バリデーションのテスト
+ autosaveオプションによる処理の簡素化

#### ActiveSupport::Concernによるコード共有
+ PersonalNameHolderモジュールの抽出
+ EmailHolderモジュールの抽出
+ PasswordHolderモジュールの抽出

### フォームオブジェクト
#### 自宅住所と勤務先の任意入力
+ フィールドの有効化・無効化
+ フォームオブジェクトの修正
+ Capybaraによるテスト

#### 顧客電話番号の管理（１） 
+ 電話番号管理機能の仕様
+ phonesテーブルとPhoneモデル
+ 顧客、自宅住所、勤務先との関連付け
+ 顧客詳細ページへの電話番号の表示

#### 顧客電話番号の管理（２）
+ 個人電話番号の入力欄表示
+ 個人電話番号の新規登録、更新、削除
+ 自宅電話番号の新規登録、更新、削除

#### 演習問題 
+ 受け入れテスト作成
+ 勤務先電話番号の新規登録、更新、削除

### 検索フォーム
#### 顧客検索フォーム
+ 顧客検索機能の仕様
+ データベーススキーマの見直し
+ 誕生日、誕生月、誕生日の設定
+ 検索フォームの表示

#### 検索機能の実装
+ indexアクションの修正
+ フォームオブジェクトの修正（１）
+ フォームオブジェクトの修正（２）
+ 検索文字列の正規化

#### 演習問題
+ 検索条件に性別を追加 
+ 検索条件に郵便番号を追加
+ 検索条件に電話番号下４桁を追加

### 次回から自動でログイン
#### 顧客のログイン・ログアウト機能
+ ルーティング
+ コントローラ
+ ビュー
+ サービスオブジェクト

#### 自動ログイン機能の追加
+ ビューの修正
+ コントローラの修正
+ 動作確認

#### RSpecによるテスト
+ クッキーの値のテスト
+ クッキーの有効期限テスト

### IPアドレスによるアクセス制限
#### IPアドレスによるアクセス制限
+ 仕様
+ 準備作業
+ AllowedSourceモデル
+ クラスメソッドinclude?
+ コントローラ修正
+ 動作確認

#### 許可IPアドレスの管理
+ 仕様
+ ルーティング
+ 許可IPアドレスの一覧表示
+ 許可IPアドレスの新規登録フォーム
+ 許可IPアドレスの追加
+ 許可IPアドレスの一括削除フォーム
+ 許可IPアドレスの一括削除

#### 演習問題
+ 管理者ページに対するIPアクセス制限（テスト）
+ 管理者ページに対するIPアクセス制限機能追加

### 多対多の関連付け
#### 多対多の関連付け
+ プログラム管理機能の概要
+ データベース設計

#### プログラム管理機能（前編）
+ プログラムの一覧表示 
+ プログラムの詳細表示

#### パフォーマンス改善
+ ベンチマーク測定の準備
+ プログラム一覧表所機能のベンチマーク測定
+ includesメソッドによる改善
+ スコープの定義
+ 編集対象の変更による改善
+ テーブルの内部結合(INNER JOIN)
+ テーブルの左結合(LEFT JOIN)

### 複雑なフォーム
#### プログラム管理機能（後編）
+ プログラムの新規登録・更新フォームの仕様
+ プログラムの新規登録・編集フォーム
+ プログラムの新規登録と更新
+ バリデーション
+ プログラムの削除

#### プログラム申し込み機能
+ 多数のオブジェクトを一括編集するフォーム
+ 隠しフィールドとCoffeeScript  
+ 多数のオブジェクトの一括更新処理

### トランザクションと排他的ロック
#### プログラム一覧表示・詳細表示機能（顧客向け)
+ ルーティング
+ 顧客トップページの修正
+ プログラムの一覧と詳細

#### プログラム申し込み機能
+ 仕様の確認
+ 「申し込む」ボタンの設置
+ 申込みを受け付ける
+ 排他制御
+ プログラム申し込み機能の仕上げ
+ 申し込みのキャンセル

### フォームの確認画面 
#### 顧客自身によるアカウント管理機能
+ ルーティング
+ 顧客トップページの修正
+ アカウント詳細表示
+ アカウント編集機能

#### 確認画面
+ ルーティング
+ 編集フォームの修正
+ 確認画面の仮実装

#### 演習問題

### Ajax
#### 顧客向け問い合わせフォーム
#### 問い合わせ到着の通知
 
### ツリー構造
#### 問い合わせの一覧表示と削除
#### メッセージツリーの表示

### タグ付け
#### 問い合わせの返信機能
#### メッセージのタグ付け
#### 一意制約と排他的ロック
#### 演習問題  

**[⬆ back to top](#構成)**

# 参照 #
+ [実践Ruby on Rails 4 現場のプロから学ぶ本格Webプログラミング](https://www.amazon.co.jp/%E5%AE%9F%E8%B7%B5Ruby-Rails-4-%E7%8F%BE%E5%A0%B4%E3%81%AE%E3%83%97%E3%83%AD%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E6%9C%AC%E6%A0%BCWeb%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E9%BB%92%E7%94%B0/dp/4844335928)
+ [現場のプロが本気で教える HTML/CSSデザイン講義](https://www.amazon.co.jp/dp/B01K3SZGR0/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)
+ [現場のプロが本気で教える HTML/CSSデザイン講義 サンプルデータ](https://github.com/basara669/html_css_book)
+ [Bootstrap for Sass](https://github.com/twbs/bootstrap-sass)
+ [Rails Bootstrap Forms](https://github.com/bootstrap-ruby/rails-bootstrap-forms)
+ [Annotate (aka AnnotateModels)](https://github.com/ctran/annotate_models)
+ [MigrationComments](https://github.com/pinnymz/migration_comments)
+ [i18n_generators](https://github.com/amatsuda/i18n_generators)